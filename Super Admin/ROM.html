<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ROM Minimal Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">

  <div class="container">
    <h2>Range of Motion Module (Minimal Demo)</h2>
    <div class="card my-4">
      <div class="card-header bg-primary text-white">
        <strong>Range of Motion (ROM) Assessment</strong>
      </div>
      <div class="card-body">

        <label>Select Joint:&nbsp;
          <select id="romJointSelect" class="form-select d-inline-block" style="width:auto;max-width:220px;">
            <option value="">--Select Joint--</option>
            <option value="Shoulder">Shoulder</option>
            <option value="Hip">Hip</option>
          </select>
          <button type="button" class="btn btn-success btn-sm" id="addRomJointBtn" style="margin-left:12px;">Add</button>
        </label>

        <div id="romTableArea" class="mt-4"></div>
      </div>
    </div>
  </div>

  <script>
  // --- Minimalist ROM Module JS ---
  document.addEventListener('DOMContentLoaded', function() {
    // Motions config for demo
    const ROM_MOTIONS = {
      Shoulder: ["Flexion", "Extension", "Abduction", "Adduction", "Internal Rotation", "External Rotation"],
      Hip: ["Flexion", "Extension", "Abduction", "Adduction", "Internal Rotation", "External Rotation"]
    };

    let patientROM = {};

    function renderROMSection() {
      const area = document.getElementById('romTableArea');
      area.innerHTML = '';
      Object.keys(patientROM).forEach(joint => {
        area.appendChild(renderJointROMTable(joint, patientROM[joint]));
      });
    }

    function renderJointROMTable(joint, data = {left:{}, right:{}}) {
      const section = document.createElement('section');
      section.className = 'mb-4';
      let html =
        `<h6 class="text-primary mb-2">${joint}</h6>
         <table class="table table-bordered">
           <thead>
             <tr>
               <th colspan="2">Left</th>
               <th colspan="2">Right</th>
             </tr>
             <tr>
               <th>Motion</th><th>Value</th>
               <th>Motion</th><th>Value</th>
             </tr>
           </thead>
           <tbody>`;
      ROM_MOTIONS[joint].forEach(motion => {
        html += `<tr>
          <td>${motion}</td>
          <td><input type="text" class="form-control form-control-sm" data-j="${joint}" data-m="${motion}" data-s="left" value="${(data.left||{})[motion]||''}"></td>
          <td>${motion}</td>
          <td><input type="text" class="form-control form-control-sm" data-j="${joint}" data-m="${motion}" data-s="right" value="${(data.right||{})[motion]||''}"></td>
        </tr>`;
      });
      html += '</tbody></table>';
      section.innerHTML = html;
      return section;
    }

    document.getElementById('addRomJointBtn').onclick = function() {
      const sel = document.getElementById('romJointSelect');
      const joint = sel.value;
      if (!joint || patientROM[joint]) return;
      patientROM[joint] = {left:{}, right:{}};
      renderROMSection();
      sel.value = '';
    };

    document.getElementById('romTableArea').addEventListener('input', function(e) {
      if (e.target.tagName !== 'INPUT') return;
      const jt = e.target.dataset.j, mo = e.target.dataset.m, s = e.target.dataset.s;
      if (!patientROM[jt]) patientROM[jt] = {left:{}, right:{}};
      patientROM[jt][s][mo] = e.target.value;
    });

    renderROMSection();
  });
  </script>
</body>
</html>
